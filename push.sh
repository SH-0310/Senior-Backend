#!/bin/bash

# 1. ì»¤ë°‹ ë©”ì‹œì§€ ë°›ê¸° (ìž…ë ¥ ì•ˆ í•˜ë©´ ê¸°ë³¸ ë©”ì‹œì§€ ì‚¬ìš©)
MESSAGE=${1:-"Update: $(date +'%Y-%m-%d %H:%M:%S')"}

echo "ðŸš€ GitHubë¡œ ì½”ë“œ ì—…ë¡œë“œë¥¼ ì‹œìž‘í•©ë‹ˆë‹¤..."

# 2. Git ìž‘ì—…
git add .
git commit -m "$MESSAGE"
git push origin main

echo "âœ… ì—…ë¡œë“œ ì™„ë£Œ! ìŠ¬ë ˆì´ë¸Œ ì„œë²„ì—ì„œ 'sh pull.sh'ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”."

# 2. ê¸°ì¡´ Flask ì„œë²„ ì¢…ë£Œ (5000ë²ˆ í¬íŠ¸)

echo "ðŸ”„ ì„œë²„ ìž¬ì‹œìž‘ ì¤€ë¹„ ì¤‘..."

PID=$(sudo lsof -t -i:5000)



if [ -z "$PID" ]; then

    echo "âš ï¸ í˜„ìž¬ ì‹¤í–‰ ì¤‘ì¸ ì„œë²„ê°€ ì—†ìŠµë‹ˆë‹¤."

else

    sudo kill -9 $PID

    echo "ðŸ’€ ê¸°ì¡´ í”„ë¡œì„¸ìŠ¤($PID)ë¥¼ ì¢…ë£Œí–ˆìŠµë‹ˆë‹¤."

fi



# 3. Flask í´ë”ë¡œ ì´ë™í•˜ì—¬ ì„œë²„ ì‹¤í–‰

# âœ… ê²½ë¡œ ìˆ˜ì •: Code -> Flask

echo "ðŸš€ Flask ì„œë²„ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤..."

cd Flask

nohup python3 app.py > ../server.log 2>&1 &
